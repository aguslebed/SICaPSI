# üìã Prompt para Implementar Sistema de Validaci√≥n de Capacitaciones

## üéØ Objetivo
Implementar un sistema completo de validaci√≥n para capacitaciones en el archivo Front/src/Components/Modals/CreateTrainingModal.jsx que garantice que todos los datos m√≠nimos est√©n completos antes de permitir la activaci√≥n, con feedback visual claro y manejo de errores/√©xitos mediante modales reutilizables.

---

## üìù Requisitos de Validaci√≥n

### 1. Datos M√≠nimos de Capacitaci√≥n (Secci√≥n "Capacitaci√≥n")
Para guardar una capacitaci√≥n (modo Deshabilitada), se requiere como m√≠nimo:
- T√≠tulo (no vac√≠o, max 50 caracteres)
- Subt√≠tulo (no vac√≠o, max 100 caracteres)
- Descripci√≥n (no vac√≠a, max 1000 caracteres)
- Imagen (URL o archivo subido)
- Fecha de inicio (formato v√°lido)
- Fecha de fin (formato v√°lido, debe ser posterior a fecha de inicio)

### 2. Requisitos para Habilitar Capacitaci√≥n (checkbox "Habilitar Capacitaci√≥n")
Para marcar isActive: true, la capacitaci√≥n debe cumplir:

#### A. Datos b√°sicos completos (del punto 1)

#### B. Al menos 1 nivel creado con TODOS estos datos:

Clase Magistral (training):
- T√≠tulo (no vac√≠o)
- Descripci√≥n (no vac√≠a)
- URL o archivo de video (no vac√≠o)
- Duraci√≥n en minutos (mayor a 0)

Bibliograf√≠a (bibliography):
- Al menos 1 elemento bibliogr√°fico con:
  - T√≠tulo (no vac√≠o)
  - Descripci√≥n (no vac√≠a)
  - Archivo PDF o enlace (no vac√≠o)

Evaluaci√≥n (test):
- T√≠tulo (no vac√≠o)
- Descripci√≥n (no vac√≠a)
- Imagen (URL o archivo)
- Estado activo (isActive: true)
- Al menos 1 escena creada con:
  - ID √∫nico
  - Descripci√≥n (no vac√≠a)
  - Video o URL (no vac√≠o)
  - Al menos 2 botones/opciones creados con:
    - Texto del bot√≥n (no vac√≠o)
    - Puntos asignados (n√∫mero)
    - ID de siguiente escena (puede ser null para final)

#### C. Asignaciones obligatorias:
- 1 Profesor asignado (assignedTeacher no vac√≠o)
- Al menos 1 estudiante inscrito (selectedStudents.length >= 1)

---

## üõ†Ô∏è Implementaci√≥n Requerida

### 1. Funci√≥n de Validaci√≥n Central

Crear funci√≥n validateTrainingForActivation() en Front/src/Components/Modals/CreateTrainingModal.jsx que retorne un objeto con:

{
  isValid: boolean,
  errors: string[]
}

La funci√≥n debe validar:
- Datos b√°sicos de capacitaci√≥n (t√≠tulo, subt√≠tulo, descripci√≥n, imagen, fechas)
- Que la fecha de fin sea posterior a la fecha de inicio
- Que exista al menos 1 nivel
- Por cada nivel, validar:
  - Training: t√≠tulo, descripci√≥n, url, duration mayor a 0
  - Bibliography: al menos 1 elemento con t√≠tulo, descripci√≥n y url
  - Test: t√≠tulo, descripci√≥n, imageUrl, isActive true
  - Test scenes: al menos 1 escena con description, videoUrl
  - Test options: cada escena debe tener al menos 2 opciones con text no vac√≠o
- Que assignedTeacher no est√© vac√≠o
- Que selectedStudents tenga al menos 1 elemento

Los mensajes de error deben ser descriptivos, por ejemplo:
- "Falta el t√≠tulo de la capacitaci√≥n"
- "La fecha de fin debe ser posterior a la fecha de inicio"
- "Nivel 1: Falta el video de la clase magistral"
- "Nivel 2: No hay elementos bibliogr√°ficos agregados"
- "Nivel 1, Escena 2: Debe tener al menos 2 botones de navegaci√≥n"
- "Debe asignar un profesor a la capacitaci√≥n"
- "Debe inscribir al menos 1 estudiante"

### 2. Funci√≥n Auxiliar isLevelComplete

Crear funci√≥n isLevelComplete(levelIndex) que retorne boolean indicando si un nivel espec√≠fico cumple todos los requisitos. Esta funci√≥n ser√° usada para los badges visuales.

### 3. Estados para Modales

Agregar los siguientes estados en CreateTrainingModal.jsx:

const [showErrorModal, setShowErrorModal] = useState(false);
const [showSuccessModal, setShowSuccessModal] = useState(false);
const [errorMessages, setErrorMessages] = useState([]);

### 4. Modificar L√≥gica del Bot√≥n Guardar

Actualizar la funci√≥n handleSave() con esta l√≥gica:

1. Validar datos b√°sicos SIEMPRE (requeridos para guardar):
   - Si faltan datos b√°sicos, mostrar modal de error con lista de campos faltantes
   - Retornar sin guardar

2. Validar fechas:
   - Si fecha fin <= fecha inicio, mostrar modal de error
   - Retornar sin guardar

3. Si el checkbox isActive est√° marcado:
   - Ejecutar validateTrainingForActivation()
   - Si no es v√°lido (isValid === false):
     - Setear errorMessages con el array de errores
     - Mostrar modal de error (setShowErrorModal(true))
     - Retornar sin guardar

4. Si pasa todas las validaciones:
   - Proceder con el guardado actual (mantener l√≥gica existente)
   - Despu√©s de guardar exitosamente, mostrar modal de √©xito (setShowSuccessModal(true))

### 5. Validaci√≥n en Tiempo Real del Checkbox

Modificar el checkbox "Habilitar Capacitaci√≥n" en PresentationForm.jsx:

- Calcular si se puede activar usando validateTrainingForActivation()
- Pasar como prop canActivate al componente PresentationForm
- Deshabilitar el checkbox (disabled={!canActivate}) cuando no se cumplan requisitos
- Agregar clase CSS para mostrar visualmente que est√° deshabilitado (opacity-50, cursor-not-allowed)
- Mostrar mensaje de ayuda debajo del checkbox cuando est√© deshabilitado: "Complete todos los requisitos para habilitar" en texto peque√±o rojo

### 6. Badges Visuales de Completitud

#### A. Badge por Nivel
En LevelsEditor.jsx, agregar badge junto al selector de nivel que muestre:
- Fondo verde con texto "‚úì Completo" si isLevelComplete(selectedLevel) es true
- Fondo amarillo con texto "‚ö† Incompleto" si isLevelComplete(selectedLevel) es false
- Clases: text-xs font-semibold px-2 py-0.5 rounded
- Verde: bg-green-100 text-green-700
- Amarillo: bg-yellow-100 text-yellow-700

#### B. Actualizar Badges en Pesta√±as de Navegaci√≥n
En CreateTrainingModal.jsx, modificar los badges de las pesta√±as:

Pesta√±a Niveles:
- Mantener el badge circular verde con el n√∫mero de niveles
- El badge siempre debe mostrarse (no condicional)

Pesta√±a Asignar Profesor:
- Agregar badge circular verde con ‚úì si assignedTeacher no est√° vac√≠o
- No mostrar badge si est√° vac√≠o
- Clases: inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 bg-green-600 text-white rounded-full text-xs font-semibold

Pesta√±a Inscribir guardias:
- El badge ya existe y est√° correcto (muestra selectedStudents.length)
- Asegurar que siempre se muestre

### 7. Modales de Error y √âxito

IMPORTANTE: Antes de crear nuevos modales, revisar si existen modales reutilizables en:
- Front/src/Components/Modals/
- Front/src/Components/

Si existen modales gen√©ricos de Success, Error o Confirmation, REUTILIZARLOS sin modificarlos. Cuidado al adaptarlos que otros componentes usan esos modales.

Si NO existen o no sirven para este prop√≥sito, crear los siguientes componentes nuevos:

#### A. Modal de Errores (ErrorListModal.jsx)
Crear en Front/src/Components/Modals/ si no existe modal reutilizable.

Estructura:
- Fondo transparente
- Tarjeta centrada (max-w-md, bg-white, shadow-2xl) cuadrada sin bordes redondeados.
- Header rojo con √≠cono de alerta y t√≠tulo "No se puede habilitar la capacitaci√≥n"
- Cuerpo con:
  - Texto: "Complete los siguientes requisitos antes de habilitar"
  - Lista scrolleable (max-h-64 overflow-y-auto) con cada error
  - Cada error con bullet point rojo
- Footer con bot√≥n "Entendido" (bg-red-600, hover:bg-red-700)
- Al hacer click en "Entendido" o backdrop, cerrar modal

Props:
- show (boolean)
- onClose (function)
- errors (string[])

#### B. Modal de √âxito (SuccessModal.jsx)
Crear en Front/src/Components/Modals/ si no existe modal reutilizable.

Estructura:
- Fondo transparente
- Tarjeta centrada (max-w-md, bg-white, shadow-2xl) cuadrada sin bordes redondeados.
- Header verde con √≠cono de check y t√≠tulo "¬°Capacitaci√≥n guardada exitosamente!"
- Cuerpo con:
  - Mensaje: "Los cambios han sido actualizados correctamente" (si isEditing) o "La capacitaci√≥n ha sido creada correctamente"
  - Si isActive es true: mostrar badge verde "‚úì La capacitaci√≥n est√° HABILITADA" con subtexto "Los estudiantes pueden acceder ahora"
  - Si isActive es false: mostrar badge azul "‚Ñπ La capacitaci√≥n est√° en modo borrador" con subtexto "Complete los requisitos para habilitarla"
- Footer con bot√≥n "Aceptar" (bg-green-600, hover:bg-green-700)
- Al hacer click en "Aceptar", cerrar modal Y cerrar el modal de edici√≥n (ejecutar onClose del CreateTrainingModal)

Props:
- show (boolean)
- onClose (function)
- isEditing (boolean)
- isActive (boolean)

### 8. Renderizar Modales

En CreateTrainingModal.jsx, al final del return (despu√©s del div de preview), agregar:

{showErrorModal && (
  <ErrorListModal
    show={showErrorModal}
    onClose={() => setShowErrorModal(false)}
    errors={errorMessages}
  />
)}

{showSuccessModal && (
  <SuccessModal
    show={showSuccessModal}
    onClose={() => {
      setShowSuccessModal(false);
      onClose(); // Cerrar el modal de edici√≥n tambi√©n
    }}
    isEditing={isEditing}
    isActive={isActive}
  />
)}

---

## üì¶ Archivos a Crear/Modificar

### Nuevos Componentes (SOLO si no existen modales reutilizables):
1. Front/src/Components/Modals/ErrorListModal.jsx
2. Front/src/Components/Modals/SuccessModal.jsx

### Modificar:
1. Front/src/Components/Modals/CreateTrainingModal.jsx (l√≥gica principal, estados, badges, renderizado de modales)
2. Front/src/Components/Modals/CreateTrainingModal/PresentationForm.jsx (recibir y usar canActivate prop en checkbox)
3. Front/src/Components/Modals/CreateTrainingModal/LevelsEditor.jsx (agregar badge de completitud por nivel)

---

## ‚úÖ Checklist de Implementaci√≥n

- [ ] Verificar si existen modales reutilizables en el proyecto
- [ ] Crear funci√≥n validateTrainingForActivation() en Front/src/Components/Modals/CreateTrainingModal.jsx
- [ ] Crear funci√≥n isLevelComplete(levelIndex) en Front/src/Components/Modals/CreateTrainingModal.jsx
- [ ] Agregar estados showErrorModal, showSuccessModal, errorMessages
- [ ] Modificar l√≥gica de handleSave() con validaciones
- [ ] Calcular canActivate y pasar como prop a PresentationForm
- [ ] Modificar checkbox en PresentationForm para usar canActivate
- [ ] Agregar badge de completitud en LevelsEditor junto al selector de nivel
- [ ] Actualizar badge de "Asignar Profesor" en navegaci√≥n
- [ ] Si no existen modales reutilizables: crear ErrorListModal.jsx
- [ ] Si no existen modales reutilizables: crear SuccessModal.jsx
- [ ] Renderizar modales condicionalmente en CreateTrainingModal
- [ ] Probar flujo completo: guardar con errores, corregir, guardar con √©xito
- [ ] Probar flujo: intentar activar sin cumplir requisitos
- [ ] Probar flujo: activar cuando se cumplen todos los requisitos
- [ ] Verificar que badges cambien de color correctamente
- [ ] Verificar que mensajes de error sean descriptivos y claros

---

## üé® Consideraciones de UX

1. Los mensajes de error deben ser espec√≠ficos, indicando exactamente qu√© nivel/secci√≥n/campo tiene el problema
2. El checkbox debe estar visualmente deshabilitado (gris, con cursor not-allowed) cuando no se pueden cumplir requisitos
3. Los badges deben actualizarse en tiempo real conforme el usuario complete campos
4. El modal de √©xito debe cerrar autom√°ticamente tanto el modal de √©xito como el modal de edici√≥n al hacer click en "Aceptar"
5. El modal de error debe permitir al usuario ver la lista completa de problemas con scroll si hay muchos
6. Los colores deben ser consistentes: verde para √©xito/completo, rojo para error, amarillo para advertencia/incompleto

---

## üöÄ Orden de Implementaci√≥n Sugerido

1. Verificar modales reutilizables existentes
2. Crear funciones de validaci√≥n (validateTrainingForActivation, isLevelComplete)
3. Agregar estados para modales
4. Modificar handleSave con validaciones
5. Implementar checkbox deshabilitado en PresentationForm
6. Agregar badges visuales de completitud
7. Crear o reutilizar modales (ErrorListModal, SuccessModal)
8. Integrar y renderizar modales en CreateTrainingModal
9. Pruebas exhaustivas de todos los flujos

---

Procede con la implementaci√≥n siguiendo este orden de prioridad. Comienza verificando si existen modales reutilizables y notif√≠came qu√© encontraste antes de crear nuevos componentes.
